---
phase: 01-core-lesson-generation
plan: 04
type: execute
wave: 3
depends_on: ["01-01", "01-03"]
files_modified:
  - .claude/skills/lesson-designer/SKILL.md
  - .claude/skills/lesson-designer/scripts/generate_slides.py
autonomous: true

must_haves:
  truths:
    - "Tool generates actual .pptx PowerPoint files"
    - "Each deck includes hidden first slide with lesson plan"
    - "Slides use sparse, teacher-led format (talking points, not paragraphs)"
    - "All slide text uses 16pt font minimum for classroom readability"
  artifacts:
    - path: ".claude/skills/lesson-designer/scripts/generate_slides.py"
      provides: "PowerPoint generation from lesson design JSON"
      exports: ["generate_slide_deck", "create_hidden_lesson_plan_slide", "create_activity_slide"]
    - path: ".claude/skills/lesson-designer/SKILL.md"
      provides: "Updated Stage 5 with slide generation instructions"
      contains: "Generate PowerPoint"
  key_links:
    - from: "SKILL.md Stage 5"
      to: "generate_slides.py"
      via: "script execution"
      pattern: "python.*generate_slides"
    - from: "generate_slides.py"
      to: "templates/slide_deck.pptx"
      via: "template loading"
      pattern: "Presentation\\(.*slide_deck\\.pptx"
---

<objective>
Implement PowerPoint slide deck generation with sparse teacher-led format and hidden lesson plan slide.

Purpose: Generate classroom-ready .pptx files that support teacher-led instruction rather than self-study. The hidden first slide provides the lesson plan while remaining invisible during presentation.

Output: generate_slides.py script that creates PowerPoint files from lesson design JSON, with updated SKILL.md Stage 5 instructions.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-core-lesson-generation/01-RESEARCH.md
@.planning/phases/01-core-lesson-generation/01-01-SUMMARY.md
@.planning/phases/01-core-lesson-generation/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PowerPoint generation script</name>
  <files>
    .claude/skills/lesson-designer/scripts/generate_slides.py
  </files>
  <action>
Create generate_slides.py with comprehensive slide deck generation.

**Key requirements from research:**
- Use python-pptx (pre-installed in Claude environment)
- Load template from templates/slide_deck.pptx
- Hidden slide implementation: `slide._element.set('show', '0')`
- Sparse format: Bullet points, not paragraphs
- 16pt minimum font (use 20pt for body, 36pt for titles)
- Include presenter notes with what teacher says/asks

**Script structure:**

```python
#!/usr/bin/env python3
"""Generate PowerPoint slide deck from lesson design JSON."""

from pptx import Presentation
from pptx.util import Pt, Inches
from pptx.dml.color import RGBColor
import json
import sys
import os

def generate_slide_deck(lesson_path, template_path, output_path):
    """Generate complete slide deck from lesson design.

    Args:
        lesson_path: Path to lesson design JSON (04_lesson_final.json)
        template_path: Path to PowerPoint template
        output_path: Where to save generated .pptx
    """

def create_hidden_lesson_plan_slide(prs, lesson):
    """Create hidden first slide with lesson plan for teacher.

    Contains: objective, agenda with timing, misconceptions, delivery tips.
    Hidden via: slide._element.set('show', '0')
    """

def create_title_slide(prs, lesson):
    """Create visible title slide with lesson title and metadata."""

def create_objectives_slide(prs, lesson):
    """Create slide showing learning objectives.

    Format: Bullet points, not paragraphs.
    Font: 20pt minimum for body text.
    """

def create_activity_slide(prs, activity, activity_num):
    """Create slide for single activity.

    Content: Activity name, duration, 3-5 key talking points.
    Presenter notes: Full instructions, Marzano level, tips.

    CRITICAL: Sparse format - max 5 bullets per slide, max 15 words per bullet.
    """

def create_assessment_slide(prs, lesson):
    """Create slide for assessment/exit ticket."""

def add_presenter_notes(slide, notes_text):
    """Add presenter notes to slide.

    Notes should include:
    - What teacher SAYS
    - What teacher ASKS
    - What to WATCH FOR (common issues)
    - TIMING guidance
    """

def format_agenda(activities):
    """Format activity list with timing for lesson plan slide."""

def format_misconceptions(misconceptions):
    """Format misconceptions list for lesson plan slide."""

def validate_output(output_path):
    """Verify generated file is valid PowerPoint."""

def main():
    """CLI entry point.

    Usage: python generate_slides.py <lesson.json> <template.pptx> <output.pptx>

    Or with defaults:
    python generate_slides.py <lesson.json>
    (uses default template and outputs to same directory as input)
    """
```

**Sparse format enforcement:**

In create_activity_slide(), enforce:
- Maximum 5 bullet points per slide
- Maximum 15 words per bullet point
- No full paragraphs - if content is longer, split across slides
- Use presenter notes for detailed instructions

Example transformation:
```
BAD (dense self-study format):
"Photosynthesis is the process by which green plants and some other
organisms use sunlight to synthesize foods from carbon dioxide and water.
The process occurs primarily in chloroplasts and produces oxygen as a byproduct."

GOOD (sparse teacher-led format):
• Light + CO2 + H2O -> Glucose + O2
• Occurs in chloroplasts
• Plants make their own food
• Oxygen is released

Presenter notes:
SAY: "Today we're exploring how plants make their own food - photosynthesis."
ASK: "What do plants need to survive?"
DEMO: Point to diagram showing chloroplast structure.
WATCH FOR: Students may think plants "eat" soil.
```

**Hidden slide implementation:**
```python
# Create lesson plan slide as first slide
lesson_plan_slide = prs.slides.add_slide(blank_layout)

# Populate with objective, agenda, misconceptions, tips
# ...

# Hide the slide (unofficial but working workaround)
lesson_plan_slide._element.set('show', '0')

# Continue with visible slides
```

**Font size requirements (SLID-04):**
- Title text: 36pt minimum (use 40pt)
- Body text: 16pt minimum (use 20pt)
- Presenter notes: 12pt (not visible during presentation)

Cover requirements SLID-01, SLID-02, SLID-03, SLID-04.
  </action>
  <verify>
generate_slides.py exists and is executable
Script loads template using python-pptx
Script creates hidden first slide with lesson plan content
Script enforces sparse format (max 5 bullets, max 15 words)
Script uses 20pt body text (above 16pt minimum)
Script adds presenter notes to slides
Script includes validation of output file
  </verify>
  <done>
generate_slides.py creates complete .pptx files from lesson design JSON
Hidden first slide contains lesson plan for teacher
Slides use sparse teacher-led format with proper font sizes
Presenter notes include SAY/ASK/DEMO/WATCH FOR guidance
  </done>
</task>

<task type="auto">
  <name>Task 2: Update SKILL.md with slide generation instructions</name>
  <files>
    .claude/skills/lesson-designer/SKILL.md
  </files>
  <action>
Update SKILL.md Stage 5 with PowerPoint generation instructions.

**Stage 5: Generate materials (Part 1 - Slides)**

Add instructions for Claude to:

1. Load validated lesson design from `04_lesson_final.json`

2. Generate slide deck:
   ```bash
   python .claude/skills/lesson-designer/scripts/generate_slides.py \
     .lesson-designer/sessions/{session_id}/04_lesson_final.json \
     .claude/skills/lesson-designer/templates/slide_deck.pptx \
     .lesson-designer/sessions/{session_id}/05_slides.pptx
   ```

3. Explain what the script creates:
   - **Slide 1 (Hidden):** Lesson plan for teacher only
     - Objective
     - Agenda with timing
     - Anticipated misconceptions
     - Delivery tips
   - **Slide 2:** Title slide with lesson title and metadata
   - **Slide 3:** Learning objectives
   - **Slides 4+:** One slide per activity (sparse format)
   - **Final slide:** Assessment/exit ticket

4. Describe the sparse format philosophy:
   ```
   IMPORTANT: Slides are designed for teacher-led instruction, not self-study.

   Each slide contains:
   - 3-5 talking points (not full paragraphs)
   - Maximum 15 words per point
   - Visual prompts where appropriate

   The full content is in presenter notes, which include:
   - What to SAY
   - What to ASK
   - What to DEMO
   - What to WATCH FOR

   Teachers should never read slides to students. Slides are conversation scaffolding.
   ```

5. If slide generation fails:
   - Check that lesson design JSON is valid
   - Check that template file exists
   - Review error message for specific issue
   - Most common issue: Missing required fields in lesson design

Include example of slide content transformation (dense to sparse).

Note: Word document generation is in Task 3 of this plan (not a separate plan to keep file generation together).
  </action>
  <verify>
SKILL.md Stage 5 includes slide generation command
Stage 5 explains hidden lesson plan slide purpose
Stage 5 describes sparse format philosophy
Stage 5 includes error handling guidance
Stage 5 includes content transformation example
  </verify>
  <done>
Stage 5 provides complete instructions for PowerPoint generation
Teachers understand the sparse format philosophy
Error handling guidance helps troubleshoot issues
  </done>
</task>

<task type="auto">
  <name>Task 3: Add slide validation to output validation</name>
  <files>
    .claude/skills/lesson-designer/scripts/validate_outputs.py
  </files>
  <action>
Create validate_outputs.py with PowerPoint-specific validation.

**Script structure:**

```python
#!/usr/bin/env python3
"""Validate generated lesson materials (slides and documents)."""

from pptx import Presentation
from pptx.util import Pt
import os
import sys

def validate_pptx(filepath):
    """Validate PowerPoint file structure and formatting.

    Checks:
    1. File exists and can be opened
    2. File size is reasonable (not empty/corrupt)
    3. Has at least 4 slides (lesson plan + title + objectives + 1 activity)
    4. First slide is hidden (lesson plan)
    5. Font sizes meet 16pt minimum for visible text
    6. Title slide has content
    7. No empty slides

    Returns:
        (errors: list, warnings: list)
    """

def check_font_sizes(prs):
    """Check all visible slides have 16pt+ fonts.

    Skip hidden slides and presenter notes.
    """

def check_hidden_lesson_plan(prs):
    """Verify first slide is hidden and contains lesson plan content."""

def validate_docx(filepath):
    """Validate Word document structure.

    Checks:
    1. File exists and can be opened
    2. No unrendered Jinja2 tags ({{ or {%)
    3. Has required sections
    4. Not empty

    Returns:
        (errors: list, warnings: list)
    """

def validate_outputs(output_dir):
    """Validate all generated files in output directory.

    Args:
        output_dir: Session output directory

    Expected files:
        - 05_slides.pptx
        - 06_worksheet.docx

    Returns:
        bool: True if all validations pass

    Generates:
        - 07_validation_report.txt
    """

def main():
    """CLI entry point.

    Usage: python validate_outputs.py <output_directory>

    Exit codes:
        0: All validations passed
        1: Passed with warnings
        2: Failed (errors found)
    """
```

**PowerPoint-specific checks:**

1. Hidden slide check:
```python
def check_hidden_lesson_plan(prs):
    errors = []
    warnings = []

    if len(prs.slides) == 0:
        errors.append("No slides in presentation")
        return errors, warnings

    first_slide = prs.slides[0]
    show_value = first_slide._element.get('show')

    if show_value != '0':
        warnings.append("First slide is not hidden - lesson plan will be visible to students")

    # Check content
    text = ''
    for shape in first_slide.shapes:
        if hasattr(shape, 'text'):
            text += shape.text

    required_sections = ['objective', 'agenda', 'misconception', 'tip']
    for section in required_sections:
        if section.lower() not in text.lower():
            warnings.append(f"Lesson plan slide may be missing {section} section")

    return errors, warnings
```

2. Font size check:
```python
def check_font_sizes(prs):
    warnings = []
    MIN_FONT_SIZE = Pt(16)

    for i, slide in enumerate(prs.slides):
        # Skip hidden slides
        if slide._element.get('show') == '0':
            continue

        for shape in slide.shapes:
            if hasattr(shape, 'text_frame'):
                for paragraph in shape.text_frame.paragraphs:
                    for run in paragraph.runs:
                        if run.font.size and run.font.size < MIN_FONT_SIZE:
                            warnings.append(
                                f"Slide {i+1}: Font size {run.font.size.pt}pt "
                                f"below 16pt minimum"
                            )

    return warnings
```

This script will be called in Stage 6 (validation stage) to verify all outputs.
  </action>
  <verify>
validate_outputs.py exists and is executable
Script validates PowerPoint files (structure, hidden slide, font sizes)
Script validates Word documents (structure, no unrendered tags)
Script generates validation report
Script returns appropriate exit codes
  </verify>
  <done>
validate_outputs.py provides comprehensive output validation
PowerPoint validation includes hidden slide and font size checks
Clear validation report helps identify issues
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. generate_slides.py can create PowerPoint from lesson design:
```bash
python .claude/skills/lesson-designer/scripts/generate_slides.py \
  test_lesson.json \
  .claude/skills/lesson-designer/templates/slide_deck.pptx \
  test_output.pptx
```

2. Generated PowerPoint:
   - Has hidden first slide with lesson plan
   - Has sparse content (no paragraphs, max 5 bullets)
   - Has 20pt body text (above 16pt minimum)
   - Has presenter notes on activity slides
   - Opens correctly in PowerPoint

3. validate_outputs.py catches issues:
   - Returns warning if first slide not hidden
   - Returns warning if font sizes below 16pt
   - Returns error if file is corrupt/empty

4. SKILL.md Stage 5 includes complete slide generation instructions

5. Coverage of requirements:
   - SLID-01: Tool generates actual .pptx files
   - SLID-02: Hidden first slide with lesson plan
   - SLID-03: Sparse, teacher-led format
   - SLID-04: 16pt font minimum
</verification>

<success_criteria>
- generate_slides.py creates valid PowerPoint files
- First slide is hidden and contains lesson plan (objective, agenda, misconceptions, tips)
- Activity slides use sparse format (max 5 bullets, max 15 words each)
- All visible text uses 16pt+ fonts (20pt body, 36pt titles)
- Presenter notes include SAY/ASK/DEMO/WATCH FOR guidance
- validate_outputs.py verifies slide requirements
- SKILL.md Stage 5 provides clear instructions
- All SLID-* requirements (01-04) are addressed
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-lesson-generation/01-04-SUMMARY.md`
</output>
