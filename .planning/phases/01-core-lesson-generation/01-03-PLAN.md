---
phase: 01-core-lesson-generation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .claude/skills/lesson-designer/SKILL.md
  - .claude/skills/lesson-designer/scripts/validate_marzano.py
  - .claude/skills/lesson-designer/scripts/design_lesson.py
autonomous: true

must_haves:
  truths:
    - "Lessons are structured according to Marzano's taxonomy (retrieval through knowledge utilization)"
    - "Tasks are aligned to lesson type (introducing, practicing, applying, synthesizing, novel application)"
    - "Cognitive rigor is enforced with minimum 40% higher-order thinking"
    - "Validation script blocks progression if cognitive demand is insufficient"
  artifacts:
    - path: ".claude/skills/lesson-designer/SKILL.md"
      provides: "Updated Stage 3 and Stage 3b instructions"
      contains: "Stage 3: Design lesson with Marzano taxonomy"
    - path: ".claude/skills/lesson-designer/scripts/validate_marzano.py"
      provides: "Cognitive rigor validation script"
      exports: ["validate_lesson", "calculate_cognitive_distribution"]
    - path: ".claude/skills/lesson-designer/scripts/design_lesson.py"
      provides: "Lesson design helper functions"
      exports: ["create_lesson_design", "save_lesson_design"]
  key_links:
    - from: "SKILL.md Stage 3b"
      to: "validate_marzano.py"
      via: "script execution"
      pattern: "python.*validate_marzano"
---

<objective>
Implement Marzano-based lesson design and cognitive rigor validation.

Purpose: Ensure generated lessons follow pedagogically sound structure and enforce cognitive demand minimums to prevent "recall-only" lessons (the 90% problem identified in research).

Output: Updated SKILL.md with Stage 3 and 3b instructions, validate_marzano.py script that enforces 40% higher-order thinking minimum, and design_lesson.py helper functions.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-core-lesson-generation/01-RESEARCH.md
@.planning/phases/01-core-lesson-generation/01-01-SUMMARY.md
@.claude/skills/lesson-designer/MARZANO.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Stage 3 - Marzano-based lesson design</name>
  <files>
    .claude/skills/lesson-designer/SKILL.md
  </files>
  <action>
Update SKILL.md to add complete Stage 3 instructions.

**Stage 3: Design lesson with Marzano taxonomy**

Add instructions for Claude to:

1. Load competency breakdown from `02_competency_breakdown.json`

2. Determine lesson type based on context:
   - **Introducing new knowledge/skills**: First lesson on a topic
   - **Practicing skills**: Reinforcing introduced content
   - **Applying knowledge**: Using knowledge in structured problems
   - **Synthesizing**: Combining multiple concepts
   - **Novel application**: Applying to new/unfamiliar contexts

   Ask teacher to confirm: "Based on what you've told me, this seems like an [introducing/practicing/etc.] lesson. Is that right?"

3. Design activities following Marzano progression:

   For "Introducing new knowledge" lessons:
   - Opening retrieval (5-10 min): Connect to prior knowledge
   - Comprehension (15-20 min): Direct instruction with checks for understanding
   - Analysis (10-15 min): Students examine/compare/contrast new content
   - Application (10-15 min): Initial practice with scaffolding
   - Assessment (5 min): Exit ticket or embedded check

   For "Applying knowledge" lessons:
   - Retrieval (5 min): Quick review of key concepts
   - Comprehension check (5 min): Verify readiness
   - Analysis (15-20 min): Structured problem-solving
   - Knowledge utilization (20-25 min): Open-ended application
   - Assessment (5 min): Reflection or exit ticket

   (Include similar breakdowns for other lesson types, referencing MARZANO.md)

4. For each activity, specify:
   - Name (action-oriented)
   - Duration (minutes)
   - Marzano level (retrieval/comprehension/analysis/knowledge_utilization)
   - Instructions (numbered steps)
   - Materials needed
   - Student output (what they produce)
   - Assessment method (how teacher knows it worked)

5. Include a hidden first slide content section:
   - Objective (single clear statement)
   - Agenda with timing
   - Anticipated misconceptions (2-3)
   - Delivery tips (2-3)

6. Save design to `03_lesson_design_v1.json`:
```json
{
  "title": "string",
  "grade_level": "string",
  "duration": "integer (minutes)",
  "lesson_type": "introducing|practicing|applying|synthesizing|novel_application",
  "objective": "string (single clear statement)",
  "activities": [
    {
      "name": "string",
      "duration": "integer",
      "marzano_level": "retrieval|comprehension|analysis|knowledge_utilization",
      "instructions": ["string"],
      "materials": ["string"],
      "student_output": "string",
      "assessment_method": "string"
    }
  ],
  "hidden_slide_content": {
    "objective": "string",
    "agenda": [{"activity": "string", "duration": "integer"}],
    "misconceptions": ["string"],
    "delivery_tips": ["string"]
  },
  "vocabulary": [{"word": "string", "definition": "string"}],
  "assessment": {
    "type": "exit_ticket|embedded|performance",
    "description": "string",
    "questions": ["string"]
  }
}
```

Reference MARZANO.md throughout: "See [MARZANO.md](MARZANO.md) for detailed guidance on each cognitive level."

Cover requirements MARZ-01 (Marzano structure) and MARZ-02 (task alignment to lesson type).
  </action>
  <verify>
SKILL.md contains "Stage 3: Design lesson with Marzano taxonomy"
Stage 3 includes all 5 lesson types with appropriate activity distributions
Stage 3 includes activity specification requirements (name, duration, marzano_level, etc.)
Stage 3 includes hidden slide content requirements
Stage 3 references MARZANO.md
JSON schema for 03_lesson_design_v1.json is complete
  </verify>
  <done>
Stage 3 enables Marzano-based lesson design with proper cognitive progression
Lesson designs include all required components (activities, hidden slide content, assessment)
Lesson type determines appropriate Marzano level distribution
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Marzano validation script</name>
  <files>
    .claude/skills/lesson-designer/scripts/validate_marzano.py
  </files>
  <action>
Create validate_marzano.py with comprehensive cognitive rigor validation.

The script must:

1. **Load and parse lesson JSON:**
```python
def validate_lesson(lesson_path):
    """Validate lesson design against Marzano framework requirements."""
```

2. **Check required fields:**
   - title, grade_level, duration, objective, activities, assessment
   - Each activity: name, duration, marzano_level, instructions

3. **Calculate cognitive distribution:**
```python
def calculate_cognitive_distribution(activities):
    """Return percentage breakdown of Marzano levels."""
    # Returns: {'retrieval': 25.0, 'comprehension': 25.0, 'analysis': 25.0, 'knowledge_utilization': 25.0}
```

4. **CRITICAL VALIDATION - Enforce cognitive rigor:**
   - **ERROR if higher-order < 40%**: (analysis + knowledge_utilization) must be >= 40%
   - **WARNING if retrieval > 30%**: Too much basic recall
   - Recommended distribution: 15% retrieval, 25% comprehension, 30% analysis, 30% knowledge utilization

5. **Check progression:**
   - Warn if cognitive level drops more than 1 level between consecutive activities
   - (retrieval=1, comprehension=2, analysis=3, knowledge_utilization=4)

6. **Check timing:**
   - Error if total activity duration exceeds lesson duration
   - Warning if more than 10 minutes unaccounted for

7. **Validate Marzano level values:**
   - Only accept: retrieval, comprehension, analysis, knowledge_utilization
   - Error on invalid values

8. **Output format:**
```python
def main():
    """CLI entry point."""
    # Usage: python validate_marzano.py <lesson.json>
    # Exit code 0: Passed
    # Exit code 1: Passed with warnings
    # Exit code 2: Failed (errors) - BLOCKS PROGRESSION
```

9. **Generate validation report:**
```
VALIDATION REPORT
=================

Cognitive Distribution:
  Retrieval: 20.0%
  Comprehension: 25.0%
  Analysis: 30.0%
  Knowledge Utilization: 25.0%

Higher-Order Thinking: 55.0% (minimum 40%) - PASS

Errors:
  (none)

Warnings:
  - Activity 4 drops 2 cognitive levels from Activity 3

RESULT: PASSED WITH WARNINGS
```

Include example lesson JSON in docstring for testing.

Cover requirement MARZ-03 (enforce cognitive rigor with minimum higher-order thinking).
  </action>
  <verify>
validate_marzano.py exists and is executable
Script validates all required fields
Script calculates cognitive distribution correctly
Script enforces 40% minimum higher-order thinking (exit code 2 if failed)
Script checks progression and timing
Script produces clear validation report
  </verify>
  <done>
Validation script enforces 40% minimum higher-order thinking
Script blocks progression (exit code 2) if cognitive demand is insufficient
Script provides actionable feedback for improving lesson design
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement Stage 3b and create design helpers</name>
  <files>
    .claude/skills/lesson-designer/SKILL.md
    .claude/skills/lesson-designer/scripts/design_lesson.py
  </files>
  <action>
Update SKILL.md with Stage 3b and create design_lesson.py helper functions.

**Stage 3b: Validate cognitive rigor**

Add instructions to SKILL.md:

1. After saving lesson design, IMMEDIATELY run validation:
   ```
   python .claude/skills/lesson-designer/scripts/validate_marzano.py .lesson-designer/sessions/{session_id}/03_lesson_design_v1.json
   ```

2. If validation FAILS (exit code 2):
   - Review the error messages
   - The most common issue is insufficient higher-order thinking
   - Return to Stage 3 and:
     - Convert some retrieval activities to comprehension
     - Convert some comprehension activities to analysis
     - Add knowledge utilization activities (design challenges, investigations)
   - Regenerate lesson design as `03_lesson_design_v2.json`
   - Re-run validation

3. If validation passes with WARNINGS (exit code 1):
   - Review warnings and consider addressing them
   - Can proceed if warnings are acceptable
   - Teacher should be informed of warnings

4. If validation PASSES (exit code 0):
   - Proceed to Stage 5 (file generation)
   - Save final validated design as `04_lesson_final.json`

5. **Maximum 3 validation attempts** - If still failing after 3 tries, present the issues to the teacher for guidance.

Include example validation workflow in SKILL.md.

**Create design_lesson.py:**

Helper functions for lesson design:

```python
def create_lesson_design(input_data, breakdown_data, lesson_type):
    """Create initial lesson design structure from input and breakdown."""

def get_recommended_distribution(lesson_type):
    """Return recommended Marzano level distribution for lesson type."""
    # Returns different distributions based on lesson type

def calculate_activity_durations(total_duration, num_activities, distribution):
    """Suggest activity durations based on total time and distribution."""

def save_lesson_design(session_id, design_data, version=1):
    """Save lesson design to session directory."""

def load_lesson_design(session_id, version=1):
    """Load lesson design from session directory."""

def get_activity_templates(marzano_level):
    """Return activity templates for a given Marzano level."""
    # Returns list of activity name patterns and typical structures
```

Use absolute paths throughout.
  </action>
  <verify>
SKILL.md contains "Stage 3b: Validate cognitive rigor"
Stage 3b includes validation command with correct path
Stage 3b includes iteration workflow (max 3 attempts)
Stage 3b includes guidance for addressing validation failures
design_lesson.py exists with all helper functions
design_lesson.py uses absolute paths
  </verify>
  <done>
Stage 3b validates cognitive rigor before proceeding
Validation blocks progression if 40% higher-order threshold not met
Clear workflow for addressing validation failures
Helper functions support lesson design process
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. SKILL.md contains:
   - Stage 3 with complete lesson design workflow
   - Stage 3b with validation workflow and iteration guidance
   - References to MARZANO.md

2. validate_marzano.py can be run from command line:
```bash
python .claude/skills/lesson-designer/scripts/validate_marzano.py test_lesson.json
# Should output validation report and exit with appropriate code
```

3. Test validation with low-rigor lesson:
```json
{
  "activities": [
    {"marzano_level": "retrieval", "duration": 15},
    {"marzano_level": "retrieval", "duration": 20},
    {"marzano_level": "comprehension", "duration": 15}
  ]
}
```
Should FAIL with "Higher-order thinking: 0% (minimum 40%)" error.

4. Test validation with good lesson:
```json
{
  "activities": [
    {"marzano_level": "retrieval", "duration": 10},
    {"marzano_level": "comprehension", "duration": 10},
    {"marzano_level": "analysis", "duration": 15},
    {"marzano_level": "knowledge_utilization", "duration": 15}
  ]
}
```
Should PASS (higher-order = 60%).

5. Coverage of requirements:
   - MARZ-01: Lessons structured according to Marzano taxonomy
   - MARZ-02: Tasks aligned to lesson type
   - MARZ-03: Cognitive rigor enforced with 40% minimum
</verification>

<success_criteria>
- Stage 3 enables complete lesson design following Marzano taxonomy
- All 5 lesson types have appropriate activity distributions
- Lesson designs include hidden slide content (objective, agenda, misconceptions, tips)
- validate_marzano.py enforces 40% higher-order thinking minimum
- Validation script blocks progression (exit code 2) on failure
- Stage 3b provides clear iteration workflow for addressing failures
- design_lesson.py provides useful helper functions
- All MARZ-* requirements (01-03) are addressed
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-lesson-generation/01-03-SUMMARY.md`
</output>
