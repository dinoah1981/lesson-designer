---
phase: 02-material-quality-formatting
plan: 05
type: execute
wave: 2
depends_on: ["02-01", "02-02", "02-03", "02-04"]
files_modified:
  - .claude/skills/lesson-designer/scripts/validate_outputs.py
  - .claude/skills/lesson-designer/SKILL.md
autonomous: false

must_haves:
  truths:
    - "Validation script checks for double-spacing in worksheets"
    - "Validation script checks for discussion structure in slides"
    - "SKILL.md documents new Phase 2 capabilities"
    - "Human verifies generated materials meet quality standards"
  artifacts:
    - path: ".claude/skills/lesson-designer/scripts/validate_outputs.py"
      provides: "Enhanced validation for Phase 2 requirements"
      contains: "line_spacing"
    - path: ".claude/skills/lesson-designer/SKILL.md"
      provides: "Updated workflow documentation"
      contains: "generate_assessment.py"
  key_links:
    - from: "validate_outputs.py"
      to: "generated .docx files"
      via: "python-docx paragraph inspection"
      pattern: "paragraph_format\\.line_spacing"
---

<objective>
Update validation script to verify Phase 2 requirements and update SKILL.md documentation, then human verification of generated materials.

Purpose: Validation ensures generated materials meet Phase 2 quality standards. Documentation updates ensure the skill remains usable. Human verification confirms materials are physically usable and pedagogically complete.

Output: Updated validate_outputs.py with Phase 2 checks, updated SKILL.md, and human-verified sample materials.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-material-quality-formatting/02-RESEARCH.md

# Files to update
@.claude/skills/lesson-designer/scripts/validate_outputs.py
@.claude/skills/lesson-designer/SKILL.md

# Reference Phase 2 Plan 1-4 outputs
@.planning/phases/02-material-quality-formatting/02-01-PLAN.md
@.planning/phases/02-material-quality-formatting/02-02-PLAN.md
@.planning/phases/02-material-quality-formatting/02-03-PLAN.md
@.planning/phases/02-material-quality-formatting/02-04-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update validate_outputs.py with Phase 2 checks</name>
  <files>.claude/skills/lesson-designer/scripts/validate_outputs.py</files>
  <action>
Add validation checks for Phase 2 requirements:

1. Add worksheet double-spacing validation:
   ```python
   def validate_worksheet_spacing(doc_path: str) -> Tuple[List[str], List[str]]:
       """Check worksheet has proper double-spacing for answer areas."""
       errors = []
       warnings = []

       doc = Document(doc_path)

       # Count paragraphs with underscore answer lines
       answer_lines = [p for p in doc.paragraphs if '_' * 10 in p.text]

       if not answer_lines:
           warnings.append("No underscore answer lines found in worksheet")
           return errors, warnings

       # Check line spacing on answer lines
       double_spaced_count = 0
       for para in answer_lines:
           spacing = para.paragraph_format.line_spacing
           if spacing is not None and spacing >= 1.8:  # Allow 1.8+ as "double"
               double_spaced_count += 1

       if double_spaced_count < len(answer_lines) * 0.5:
           warnings.append(f"Only {double_spaced_count}/{len(answer_lines)} answer lines are double-spaced (MATL-02)")

       return errors, warnings
   ```

2. Add discussion slide validation:
   ```python
   def validate_discussion_slides(pptx_path: str) -> Tuple[List[str], List[str]]:
       """Check discussion slides have proper structure (DISC-01, DISC-02, DISC-03)."""
       errors = []
       warnings = []

       prs = Presentation(pptx_path)

       discussion_slides_found = False
       facilitation_notes_found = False

       for slide in prs.slides:
           # Check for discussion indicators in slide text
           slide_text = ""
           for shape in slide.shapes:
               if hasattr(shape, "text"):
                   slide_text += shape.text.lower()

           if "discussion" in slide_text or "üí¨" in slide_text:
               discussion_slides_found = True

               # Check for time allocations
               if not any(x in slide_text for x in ['min', 'minute', 'time']):
                   warnings.append("Discussion slide missing time allocations (DISC-01)")

               # Check presenter notes for facilitation guidance
               if slide.has_notes_slide:
                   notes_text = slide.notes_slide.notes_text_frame.text.lower()
                   if 'facilitation' in notes_text or 'watch for' in notes_text:
                       facilitation_notes_found = True

       if discussion_slides_found and not facilitation_notes_found:
           warnings.append("Discussion slides missing teacher facilitation notes (DISC-03)")

       return errors, warnings
   ```

3. Update main validate_session() to include new checks:
   ```python
   # In validate_session():
   # After existing PPTX validation
   if pptx_path:
       disc_errors, disc_warnings = validate_discussion_slides(pptx_path)
       errors.extend(disc_errors)
       warnings.extend(disc_warnings)

   # After existing DOCX validation
   if docx_path:
       ws_errors, ws_warnings = validate_worksheet_spacing(docx_path)
       errors.extend(ws_errors)
       warnings.extend(ws_warnings)
   ```

4. Add validation for assessment files:
   ```python
   def validate_assessment(doc_path: str) -> Tuple[List[str], List[str]]:
       """Validate assessment document structure."""
       errors = []
       warnings = []

       doc = Document(doc_path)

       # Check for rubric table (performance tasks, Socratic guides)
       has_rubric = any(len(table.columns) >= 4 for table in doc.tables)

       # Check for answer lines
       has_answer_space = any('_' * 10 in p.text for p in doc.paragraphs)

       if not has_answer_space and not has_rubric:
           warnings.append("Assessment missing both answer space and rubric")

       return errors, warnings
   ```
  </action>
  <verify>
Run validation on generated files from Phase 2:
```bash
cd "C:\Users\david\OneDrive\Desktop\lesson-designer"
python .claude/skills/lesson-designer/scripts/validate_outputs.py .lesson-designer/sessions/ 2>&1 | findstr -i "matl\|disc\|spacing"
```
Should show validation checks running (even if no sessions exist yet).
  </verify>
  <done>
- validate_worksheet_spacing() checks for double-spaced answer lines
- validate_discussion_slides() checks for time allocations and facilitation notes
- validate_assessment() checks for rubric tables or answer space
- Main validation integrates all Phase 2 checks
  </done>
</task>

<task type="auto">
  <name>Task 2: Update SKILL.md with Phase 2 capabilities</name>
  <files>.claude/skills/lesson-designer/SKILL.md</files>
  <action>
Update SKILL.md to document Phase 2 features:

1. Update version to 2.0.0

2. Add new capabilities to Workflow Overview:
   ```markdown
   ## Workflow Overview

   Execute these stages sequentially:

   - [ ] **Stage 1: Gather competency requirements**
   - [ ] **Stage 2: Decompose into skills and knowledge**
   - [ ] **Stage 2b: Teacher classification and proficiency targets**
   - [ ] **Stage 3: Design lesson with Marzano taxonomy**
   - [ ] **Stage 3b: Validate cognitive rigor**
   - [ ] **Stage 5: Generate materials (.pptx + .docx)**
   - [ ] **Stage 5b: Generate simulation (if appropriate)** ‚Üê NEW
   - [ ] **Stage 5c: Generate assessment (if dedicated assessment lesson)** ‚Üê NEW
   - [ ] **Stage 6: Validate outputs**
   - [ ] **Stage 7: Present to teacher**
   ```

3. Add new Stage 5b section for simulations:
   ```markdown
   ### Stage 5b: Generate Simulation (Optional)

   **Purpose:** Create interactive HTML/JS simulation when competency involves visualization.

   **When to use:** If competency involves:
   - Supply/demand and market economics
   - Physics motion and velocity
   - Ecosystem dynamics

   **Process:**

   ```bash
   python .claude/skills/lesson-designer/scripts/generate_simulation.py \
     "{competency statement}" \
     .lesson-designer/sessions/{session_id}/simulation.html
   ```

   If no matching simulation template exists, script exits cleanly (code 0) with message.

   **Output:** `simulation.html` - self-contained HTML with embedded p5.js simulation
   ```

4. Add new Stage 5c section for assessments:
   ```markdown
   ### Stage 5c: Generate Dedicated Assessment (Optional)

   **Purpose:** Create quiz, test, Socratic guide, or performance task for dedicated assessment lessons.

   **When to use:** When lesson type is assessment (not embedded formative assessment).

   **Assessment Types:**

   | Type | Use For | Output |
   |------|---------|--------|
   | quiz | Short formative check (10-15 questions) | quiz.docx + answer_key.docx |
   | test | Summative assessment (20+ questions, multiple formats) | test.docx + answer_key.docx |
   | performance | Extended response or project with rubric | performance_task.docx |
   | socratic | Graded discussion with participation rubric | socratic_guide.docx |

   **Process:**

   Create assessment specification JSON, then generate:

   ```bash
   python .claude/skills/lesson-designer/scripts/generate_assessment.py \
     .lesson-designer/sessions/{session_id}/assessment_spec.json \
     .lesson-designer/sessions/{session_id}/assessment.docx
   ```

   **Output:** Assessment document + answer key (for quiz/test types)
   ```

5. Update Stage 5 Part 1 to reference discussion structure:
   - Add note about discussion detection
   - Reference facilitation notes generation

6. Update Stage 5 Part 2 to reference double-spacing:
   - Remove "Phase 1 Formatting Note" about 1.5 spacing
   - Document that worksheets now use double-spacing for answer areas

7. Update Quick Reference - Script Commands section:
   ```markdown
   # Stage 5b: Generate simulation (if appropriate)
   python .claude/skills/lesson-designer/scripts/generate_simulation.py \
     "{competency}" simulation.html

   # Stage 5c: Generate assessment (if dedicated assessment lesson)
   python .claude/skills/lesson-designer/scripts/generate_assessment.py \
     assessment_spec.json assessment.docx
   ```
  </action>
  <verify>
Check SKILL.md has new content:
```bash
cd "C:\Users\david\OneDrive\Desktop\lesson-designer"
type .claude\skills\lesson-designer\SKILL.md | findstr "Stage 5b\|Stage 5c\|simulation\|assessment"
```
Should find references to new stages and scripts.
  </verify>
  <done>
- SKILL.md version updated to 2.0.0
- Stage 5b (simulation) documented
- Stage 5c (assessment) documented
- Script commands section updated
- Phase 1 formatting note removed, double-spacing documented
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 2 material quality enhancements:
1. Worksheet double-spacing for student writing (MATL-02)
2. Discussion slides with time allocations and facilitation notes (DISC-01, DISC-02, DISC-03)
3. HTML/JS simulation generator with p5.js (MATL-04)
4. Assessment generator for quizzes, tests, Socratic guides, performance tasks (ASMT-02, ASMT-03, ASMT-04)
5. Updated validation and documentation
  </what-built>
  <how-to-verify>
Generate a complete lesson with all Phase 2 features and verify:

1. **Create test lesson with discussion activity:**
   ```bash
   cd "C:\Users\david\OneDrive\Desktop\lesson-designer"
   # Use existing test fixture or create sample lesson
   ```

2. **Check worksheet double-spacing:**
   - Generate worksheet from lesson
   - Open .docx file
   - Verify answer lines have visible double-spacing
   - Confirm adequate room for handwritten responses

3. **Check discussion slide structure:**
   - Generate slides from lesson with discussion activity
   - Open .pptx file
   - Find discussion slide - verify:
     - Shows Opening/Discussion/Closing sections
     - Time allocations visible (e.g., "Pair 5m | Share 5m")
   - Check presenter notes (View ‚Üí Notes) - verify:
     - Contains "FACILITATION GUIDE"
     - Includes prompts to use
     - Includes "WATCH FOR" section

4. **Check simulation generation:**
   ```bash
   python .claude/skills/lesson-designer/scripts/generate_simulation.py \
     "Students analyze supply and demand curves" test_sim.html
   ```
   - Open test_sim.html in browser
   - Verify p5.js simulation loads and runs
   - Test keyboard controls (R to reset, Space to pause)

5. **Check assessment generation:**
   ```bash
   # Create test quiz
   echo {"title":"Test Quiz","type":"quiz","multiple_choice":[{"question":"Q1?","choices":["A","B","C","D"],"answer":"B"}],"short_answer":[{"question":"Explain...","points":5}]} > test_quiz.json
   python .claude/skills/lesson-designer/scripts/generate_assessment.py test_quiz.json

   # Create performance task
   echo {"title":"Essay Task","type":"performance","description":"Write essay","criteria":[{"name":"Content","descriptors":["Excellent","Good","Fair","Poor"]}]} > test_perf.json
   python .claude/skills/lesson-designer/scripts/generate_assessment.py test_perf.json
   ```
   - Open quiz_assessment.docx - verify multiple choice and short answer sections
   - Open quiz_assessment_answer_key.docx - verify answers present
   - Open performance_assessment.docx - verify rubric table with 4 levels

**Success criteria:**
- Worksheets: Answer lines visibly double-spaced, adequate for handwriting
- Slides: Discussion structure clear, facilitation notes comprehensive
- Simulation: Runs in browser, interactive controls work
- Assessment: All formats generate properly, rubrics have observable descriptors
  </how-to-verify>
  <resume-signal>Type "approved" if all materials meet quality standards, or describe specific issues to address</resume-signal>
</task>

</tasks>

<verification>
1. validate_outputs.py includes Phase 2 checks (spacing, discussion structure)
2. SKILL.md documents Stage 5b (simulation) and Stage 5c (assessment)
3. Human has verified worksheet spacing is adequate for handwriting
4. Human has verified discussion slides have structure and facilitation notes
5. Human has verified simulation runs in browser
6. Human has verified assessment documents have proper rubrics
</verification>

<success_criteria>
Phase 2 complete when human verifies:
- MATL-02: Worksheets physically usable (adequate writing space)
- MATL-04: Simulations generate and run correctly
- DISC-01, DISC-02, DISC-03: Discussion activities fully structured
- ASMT-02, ASMT-03, ASMT-04: Assessment types generate with proper rubrics
- Documentation updated for all new features
</success_criteria>

<output>
After completion, create `.planning/phases/02-material-quality-formatting/02-05-SUMMARY.md`
</output>
