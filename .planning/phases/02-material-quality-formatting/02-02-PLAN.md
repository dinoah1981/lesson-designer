---
phase: 02-material-quality-formatting
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/lesson-designer/scripts/generate_slides.py
autonomous: true

must_haves:
  truths:
    - "Discussion activities show explicit time allocations (e.g., 'Pair: 5 min | Share: 5 min')"
    - "Discussion slides have three-part structure: Opening, Prompts, Closing"
    - "Teacher facilitation notes include timing, facilitation moves, and watch-for guidance"
  artifacts:
    - path: ".claude/skills/lesson-designer/scripts/generate_slides.py"
      provides: "Enhanced slide generation with discussion structure"
      contains: "create_discussion_slide"
  key_links:
    - from: "generate_slides.py"
      to: "lesson.json activities"
      via: "activity['discussion_structure'] or detected discussion type"
      pattern: "FACILITATION GUIDE"
---

<objective>
Enhance slide generation to produce properly structured discussion activities with time allocations and teacher facilitation guidance.

Purpose: Discussion activities require clear structure to be effective. Teachers need time allocations, discussion prompts organized as opening/main/closing, and facilitation notes. This addresses requirements DISC-01, DISC-02, and DISC-03.

Output: Updated generate_slides.py that detects discussion activities and creates structured slides with comprehensive teacher notes.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-material-quality-formatting/02-RESEARCH.md

# Existing script to modify
@.claude/skills/lesson-designer/scripts/generate_slides.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discussion slide generator function</name>
  <files>.claude/skills/lesson-designer/scripts/generate_slides.py</files>
  <action>
Add a new function to generate structured discussion slides:

1. Add discussion detection helper near top of file:
   ```python
   def is_discussion_activity(activity: dict) -> bool:
       """Detect if activity is a discussion based on name or type."""
       name_lower = activity.get('name', '').lower()
       discussion_keywords = ['discussion', 'debate', 'seminar', 'share',
                              'pair', 'group talk', 'debrief', 'reflection']
       return any(kw in name_lower for kw in discussion_keywords)
   ```

2. Add discussion structure constants:
   ```python
   # Default discussion timing structure (in minutes)
   DISCUSSION_STRUCTURE = {
       'opening': 2,      # Hook question, activate prior knowledge
       'pair_work': 5,    # Partner discussion
       'group_share': 5,  # Whole class sharing
       'closing': 3       # Synthesis, exit question
   }
   ```

3. Create the discussion slide function:
   ```python
   def create_discussion_slide(prs, slide, activity):
       """Create structured discussion slide with timing breakdown."""
       duration = activity.get('duration', 15)

       # Header with total time
       add_header_bar(prs, slide,
           f"üí¨ {activity['name']}",
           subtitle_text="Discussion Activity",
           timer_text=f"‚è±Ô∏è {duration}m")

       add_light_background(prs, slide)

       # Calculate timing breakdown
       opening_time = min(2, duration // 6)
       closing_time = min(3, duration // 5)
       main_time = duration - opening_time - closing_time
       pair_time = main_time // 2
       share_time = main_time - pair_time

       # Content sections with timing
       y_pos = 1.9

       # Opening section
       add_content_box(prs, slide, Inches(0.5), Inches(y_pos), Inches(12.333), Inches(1.2))
       opening_box = slide.shapes.add_textbox(Inches(0.7), Inches(y_pos + 0.1), Inches(11.9), Inches(1))
       tf = opening_box.text_frame
       p = tf.paragraphs[0]
       run = p.add_run()
       run.text = f"üéØ Opening ({opening_time} min)"
       run.font.bold = True
       run.font.size = Pt(18)
       run.font.color.rgb = HEADER_BLUE

       # Get opening from activity or generate default
       opening = activity.get('discussion_structure', {}).get('opening',
           activity.get('instructions', [''])[0] if activity.get('instructions') else 'Opening question...')
       p2 = tf.add_paragraph()
       run2 = p2.add_run()
       run2.text = opening[:100] if len(str(opening)) > 100 else str(opening)
       run2.font.size = Pt(16)

       y_pos += 1.4

       # Main discussion section
       add_content_box(prs, slide, Inches(0.5), Inches(y_pos), Inches(12.333), Inches(2.5))
       main_box = slide.shapes.add_textbox(Inches(0.7), Inches(y_pos + 0.1), Inches(11.9), Inches(2.3))
       tf = main_box.text_frame
       p = tf.paragraphs[0]
       run = p.add_run()
       run.text = f"üí≠ Discussion ({main_time} min: Pair {pair_time}m | Share {share_time}m)"
       run.font.bold = True
       run.font.size = Pt(18)
       run.font.color.rgb = HEADER_BLUE

       # Discussion prompts
       prompts = activity.get('discussion_structure', {}).get('prompts',
           activity.get('instructions', ['Discuss the main concepts...']))
       for prompt in prompts[:3]:
           p = tf.add_paragraph()
           run = p.add_run()
           run.text = f"‚Ä¢ {prompt[:80]}"
           run.font.size = Pt(16)

       y_pos += 2.7

       # Closing section
       add_content_box(prs, slide, Inches(0.5), Inches(y_pos), Inches(12.333), Inches(1.1))
       closing_box = slide.shapes.add_textbox(Inches(0.7), Inches(y_pos + 0.1), Inches(11.9), Inches(0.9))
       tf = closing_box.text_frame
       p = tf.paragraphs[0]
       run = p.add_run()
       run.text = f"‚úÖ Closing ({closing_time} min)"
       run.font.bold = True
       run.font.size = Pt(18)
       run.font.color.rgb = HEADER_BLUE

       closing = activity.get('discussion_structure', {}).get('closing', 'Synthesize key takeaways')
       p2 = tf.add_paragraph()
       run2 = p2.add_run()
       run2.text = closing[:100] if len(str(closing)) > 100 else str(closing)
       run2.font.size = Pt(16)

       # Add facilitation notes (next task will enhance these)
       notes_slide = slide.notes_slide
       notes_tf = notes_slide.notes_text_frame
       notes_tf.text = f"DISCUSSION: {activity['name']}\n"
       notes_tf.text += f"Total time: {duration} minutes\n\n"
       notes_tf.text += f"TIME BREAKDOWN:\n"
       notes_tf.text += f"  ‚Ä¢ Opening: {opening_time} min\n"
       notes_tf.text += f"  ‚Ä¢ Pair work: {pair_time} min\n"
       notes_tf.text += f"  ‚Ä¢ Group share: {share_time} min\n"
       notes_tf.text += f"  ‚Ä¢ Closing: {closing_time} min\n"
   ```

4. Update generate_slides() to use discussion slide for detected activities:
   - In the activity loop, check `if is_discussion_activity(activity)`
   - If true, call `create_discussion_slide(prs, slide, activity)`
   - Otherwise, call existing `create_activity_slide(prs, slide, activity)`
  </action>
  <verify>
Test with a lesson that has discussion activities:
```bash
cd "C:\Users\david\OneDrive\Desktop\lesson-designer"
python -c "
import json
from scripts.generate_slides import is_discussion_activity
test = {'name': 'Think-Pair-Share Discussion', 'duration': 10}
print('Is discussion:', is_discussion_activity(test))
"
```
Should print "Is discussion: True"
  </verify>
  <done>
- is_discussion_activity() correctly detects discussion activities
- create_discussion_slide() generates three-part structure (Opening/Discussion/Closing)
- Time allocations visible on slide (e.g., "Pair 5m | Share 5m")
- generate_slides() routes discussion activities to new function
  </done>
</task>

<task type="auto">
  <name>Task 2: Add comprehensive teacher facilitation notes</name>
  <files>.claude/skills/lesson-designer/scripts/generate_slides.py</files>
  <action>
Enhance the facilitation notes in create_discussion_slide():

1. Add facilitation templates near top of file:
   ```python
   # Facilitation guidance templates
   FACILITATION_PROMPTS = [
       "Can you build on what [student] said?",
       "Who has a different perspective?",
       "What evidence supports that claim?",
       "How does this connect to what we learned earlier?",
       "Can you give a specific example?"
   ]

   DISCUSSION_WATCH_FOR = [
       "Students dominating airtime - redirect with 'Let's hear from someone new'",
       "Off-task conversations - physical proximity or refocus question",
       "Quiet students - invite with 'What do you think, [name]?'",
       "Surface-level responses - push with 'Tell me more about that'"
   ]
   ```

2. Update notes generation in create_discussion_slide() to include:
   ```python
   # Full facilitation notes
   notes_slide = slide.notes_slide
   notes_tf = notes_slide.notes_text_frame
   notes_tf.text = f"""FACILITATION GUIDE: {activity['name']}

TIME ALLOCATION ({duration} min total):
  ‚Ä¢ Opening: {opening_time} min
  ‚Ä¢ Pair discussion: {pair_time} min
  ‚Ä¢ Whole group share: {share_time} min
  ‚Ä¢ Closing: {closing_time} min

FACILITATION MOVES:
  ‚Ä¢ During pair work: Circulate, listen, note interesting ideas to highlight
  ‚Ä¢ During share: Track who speaks, balance airtime across students
  ‚Ä¢ Productive struggle: Let silence sit for 3-5 seconds before intervening

PROMPTS TO USE:
"""
   for prompt in FACILITATION_PROMPTS[:4]:
       notes_tf.text += f"  ‚Ä¢ '{prompt}'\n"

   notes_tf.text += "\nWATCH FOR:\n"
   for warning in DISCUSSION_WATCH_FOR[:3]:
       notes_tf.text += f"  ‚ö†Ô∏è {warning}\n"

   # Add activity-specific notes if provided
   if activity.get('assessment_method'):
       notes_tf.text += f"\nASSESSMENT: {activity['assessment_method']}\n"
   ```

3. Also update create_activity_slide() presenter notes to be more structured:
   - Change from generic "SAY/ASK/WATCH FOR" to activity-specific guidance
   - Include the marzano_level context for pedagogical relevance
  </action>
  <verify>
Generate slides with discussion activity and check notes:
```bash
cd "C:\Users\david\OneDrive\Desktop\lesson-designer"
python -c "
import json
# Create test lesson with discussion
lesson = {
    'title': 'Test Lesson',
    'grade_level': '8th Grade',
    'duration': 50,
    'objective': 'Test objective',
    'activities': [
        {
            'name': 'Think-Pair-Share Discussion',
            'duration': 15,
            'marzano_level': 'analysis',
            'instructions': ['Discuss the causes of the event'],
            'assessment_method': 'Observe pair discussions'
        }
    ],
    'hidden_slide_content': {'agenda': [], 'misconceptions': [], 'delivery_tips': []},
    'assessment': {'questions': ['Q1']}
}
with open('test_discussion_lesson.json', 'w') as f:
    json.dump(lesson, f)
"
python .claude/skills/lesson-designer/scripts/generate_slides.py test_discussion_lesson.json test_discussion_slides.pptx
```
Open test_discussion_slides.pptx, check Notes pane contains "FACILITATION GUIDE" with timing.
  </verify>
  <done>
- Facilitation notes include TIME ALLOCATION section with specific times
- Notes include FACILITATION MOVES for managing discussion
- Notes include PROMPTS TO USE for teacher questions
- Notes include WATCH FOR guidance on common issues
- All DISC-01, DISC-02, DISC-03 requirements satisfied
  </done>
</task>

</tasks>

<verification>
1. Generate slides from lesson with discussion activity - completes without error
2. Discussion slides show three-part structure (Opening/Discussion/Closing)
3. Time allocations visible on slide face (e.g., "Pair 5m | Share 5m")
4. Presenter notes contain FACILITATION GUIDE with timing, prompts, watch-for
5. Non-discussion activities still use standard activity slide format
</verification>

<success_criteria>
- DISC-01 satisfied: Discussion activities include explicit time allocations
- DISC-02 satisfied: Discussion activities include opening/prompts/closing structure
- DISC-03 satisfied: Discussion activities include teacher facilitation guidance
- Discussion detection correctly identifies discussion vs. non-discussion activities
- No regressions in existing slide generation
</success_criteria>

<output>
After completion, create `.planning/phases/02-material-quality-formatting/02-02-SUMMARY.md`
</output>
