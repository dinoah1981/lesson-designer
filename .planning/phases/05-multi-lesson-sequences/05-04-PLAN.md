---
phase: 05-multi-lesson-sequences
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - .claude/skills/lesson-designer/SKILL.md
  - .claude/skills/lesson-designer/tests/test_sequence_e2e.py
autonomous: false

must_haves:
  truths:
    - "SKILL.md documents sequence workflow with Stage 0.5 sequence planning"
    - "Teacher can plan multiple lessons for a competency or series of competencies"
    - "Lessons within a sequence build on each other with logical progression"
    - "Full sequence workflow is verified end-to-end"
  artifacts:
    - path: ".claude/skills/lesson-designer/SKILL.md"
      provides: "Updated documentation with sequence workflow"
      contains: "Stage 0.5: Sequence Planning"
    - path: ".claude/skills/lesson-designer/tests/test_sequence_e2e.py"
      provides: "Integration test for sequence workflow"
  key_links:
    - from: "SKILL.md"
      to: "sequence_manager.py"
      via: "documents create_sequence_session usage"
      pattern: "sequence_manager.py"
    - from: "SKILL.md"
      to: "sequence_context.py"
      via: "documents context assembly workflow"
      pattern: "build_context_for_lesson"
---

<objective>
Integrate sequence workflow into SKILL.md and verify with end-to-end test.

Purpose: Complete the Phase 5 implementation by documenting the new sequence workflow and verifying all components work together. Teacher should be able to plan a 3-lesson sequence, generate lessons with context awareness, and produce a sequence-level assessment.

Output: Updated SKILL.md v3.0.0 with sequence documentation, plus integration test proving full workflow.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-multi-lesson-sequences/05-RESEARCH.md
@.planning/phases/05-multi-lesson-sequences/05-01-SUMMARY.md
@.planning/phases/05-multi-lesson-sequences/05-02-SUMMARY.md
@.planning/phases/05-multi-lesson-sequences/05-03-SUMMARY.md

# Current SKILL.md to update
@.claude/skills/lesson-designer/SKILL.md

# New scripts to document
@.claude/skills/lesson-designer/scripts/sequence_manager.py
@.claude/skills/lesson-designer/scripts/sequence_context.py
@.claude/skills/lesson-designer/scripts/generate_sequence_assessment.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SKILL.md with sequence workflow</name>
  <files>.claude/skills/lesson-designer/SKILL.md</files>
  <action>
Update SKILL.md to version 3.0.0 with multi-lesson sequence support.

Changes to make:

1. Update version in frontmatter to 3.0.0

2. Update description to mention sequence planning:
   "Design complete, classroom-ready lessons and multi-lesson sequences using Robert Marzano's New Taxonomy framework."

3. Add new Stage 0.5 before existing Stage 1 in Workflow Overview:
   ```
   - [ ] **Stage 0.5: Sequence Planning** (optional - for multi-lesson units)
   ```

4. Update State Directory Structure section to show sequence layout:
   ```
   .lesson-designer/sessions/{sequence_id}/
   ├── sequence_metadata.json              # Sequence-level planning
   ├── lesson_01/
   │   ├── 01_input.json                   # Existing lesson files
   │   ├── 04_lesson_final.json
   │   ├── lesson_summary.json             # Compressed summary for context
   │   └── materials/
   ├── lesson_02/
   │   └── ...
   └── sequence_assessment.docx            # Summative assessment
   ```

5. Add new Stage 0.5 section after Framework Reference, before Stage 1:

   ```markdown
   ### Stage 0.5: Sequence Planning (Optional)

   **Purpose:** Plan coherent multi-lesson units (2-4 weeks) before generating individual lessons.

   **When to use:** When teacher wants multiple lessons that build on each other. Skip for single standalone lessons.

   **Process:**

   1. **Gather sequence information:**
      - What competencies should students master by the end?
      - How many total lessons in the sequence?
      - What grade level and lesson duration?

   2. **Create sequence session:**
      ```python
      from sequence_manager import create_sequence_session

      sequence_id = create_sequence_session(
          competencies=["Analyze primary sources", "Construct evidence-based arguments"],
          grade_level="8th grade",
          total_lessons=6,
          lesson_duration=55
      )
      ```

   3. **Assign competencies to lesson ranges:**
      ```python
      from sequence_manager import assign_competency_to_lessons

      assign_competency_to_lessons(sequence_id, "comp-01", start_lesson=1, end_lesson=3)
      assign_competency_to_lessons(sequence_id, "comp-02", start_lesson=4, end_lesson=6)
      ```

   4. **Plan vocabulary progression:**
      - Identify key terms for each lesson
      - Terms accumulate - lesson 3 assumes students know lesson 1-2 terms

   **Output:**
   - `sequence_metadata.json` with competencies, lesson ranges, vocabulary plan
   - Lesson subdirectories ready for individual lesson generation

   **Next:** Execute Stages 1-7 for each lesson in sequence, using context from prior lessons.
   ```

6. Update Stage 3 to mention context awareness for sequences:

   Add at the start of Stage 3:
   ```markdown
   > **Sequence Mode:** If designing lesson N in a sequence, first build context:
   > ```python
   > from sequence_context import build_context_for_lesson
   > context = build_context_for_lesson(sequence_id, lesson_num)
   > # context includes prior_lessons, vocabulary_already_taught
   > ```
   > Use this context when designing the lesson to maintain progression coherence.
   ```

7. Update Stage 7 to mention lesson summary creation for sequences:

   Add at the end of Stage 7:
   ```markdown
   > **Sequence Mode:** After lesson approval, create summary for future context:
   > ```python
   > from sequence_context import create_lesson_summary, update_vocabulary_progression
   > summary = create_lesson_summary(sequence_id, lesson_num, lesson_json, persona_feedback)
   > update_vocabulary_progression(sequence_id, lesson_num, introduced_terms)
   > ```
   ```

8. Add new Stage 8 section for sequence-level assessment:

   ```markdown
   ### Stage 8: Generate Sequence Assessment (Sequences Only)

   **Purpose:** Create summative assessment covering the entire lesson sequence.

   **When to run:** After all lessons in sequence are complete.

   **Process:**

   1. **Choose assessment type:**
      - `cumulative_test` - Multi-section test with questions from all lessons
      - `performance_task` - Complex task requiring integration of all competencies
      - `portfolio_review` - Reflection and self-assessment guide

   2. **Generate assessment:**
      ```python
      from generate_sequence_assessment import generate_sequence_assessment, SequenceAssessmentConfig

      config = SequenceAssessmentConfig(
          assessment_type="cumulative_test",
          title="Unit 3 Assessment: Primary Source Analysis",
          time_limit=60
      )

      assessment = generate_sequence_assessment(sequence_id, config)
      ```

   3. **Review and approve:**
      - Assessment covers vocabulary from all lessons
      - Questions span Marzano levels (retrieval through knowledge utilization)
      - Performance tasks integrate multiple competencies

   **Output:**
   - `sequence_assessment.json` - Assessment structure
   - `sequence_assessment.docx` - Printable assessment document
   - `sequence_assessment_key.docx` - Answer key (for cumulative_test)
   ```

Preserve all existing content. Only add sequence-related updates.
  </action>
  <verify>
Read SKILL.md and verify:
1. Version is 3.0.0
2. Stage 0.5 exists
3. Stage 8 exists
4. Sequence directory structure documented
5. Context awareness documented in Stage 3
  </verify>
  <done>
SKILL.md updated to v3.0.0 with complete sequence workflow documentation
  </done>
</task>

<task type="auto">
  <name>Task 2: Create end-to-end integration test for sequences</name>
  <files>.claude/skills/lesson-designer/tests/test_sequence_e2e.py</files>
  <action>
Create integration test that exercises full sequence workflow.

Test scenario: 3-lesson sequence for "Analyze primary sources" competency

Test steps:

1. **Stage 0.5 - Create sequence:**
   - Call create_sequence_session() with 1 competency, 3 lessons
   - Assign competency to lessons 1-3
   - Set vocabulary_progression for each lesson

2. **Stage 1-7 - Generate lesson 1:**
   - Create mock input for lesson 1
   - Create mock lesson_final JSON with activities
   - Call create_lesson_summary() to save summary
   - Verify summary created in lesson_01/

3. **Stage 1-7 - Generate lesson 2 with context:**
   - Call build_context_for_lesson(sequence_id, 2)
   - Verify context includes lesson 1 summary
   - Verify vocabulary_already_taught includes lesson 1 terms
   - Create mock lesson 2 and summary

4. **Stage 1-7 - Generate lesson 3 with context:**
   - Call build_context_for_lesson(sequence_id, 3)
   - Verify context includes lessons 1 and 2 summaries
   - Create mock lesson 3 using terms from lessons 1-2
   - Call check_vocabulary_continuity() - verify is_coherent = true
   - Create summary

5. **Stage 8 - Generate sequence assessment:**
   - Call generate_sequence_assessment() with cumulative_test config
   - Verify assessment references vocabulary from all 3 lessons
   - Verify .docx file created

6. **Cleanup:**
   - Remove test sequence directory

Assertions:
- Each lesson has lesson_summary.json
- Context for lesson 3 includes 2 prior summaries
- Vocabulary continuity is maintained
- Sequence assessment covers all lessons
- All files are valid JSON/DOCX

Use pytest fixtures.
Mark as integration test: `@pytest.mark.integration`
  </action>
  <verify>
Run: `pytest .claude/skills/lesson-designer/tests/test_sequence_e2e.py -v`
Expected: Test passes, full sequence workflow verified
  </verify>
  <done>
test_sequence_e2e.py exists, integration test passes, proves full workflow works
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete multi-lesson sequence workflow:
1. Sequence session management (05-01)
2. Context awareness and vocabulary tracking (05-02)
3. Sequence-level assessment generation (05-03)
4. SKILL.md v3.0.0 documentation (05-04)
  </what-built>
  <how-to-verify>
1. Review SKILL.md:
   - Open `.claude/skills/lesson-designer/SKILL.md`
   - Verify Stage 0.5 (Sequence Planning) is documented
   - Verify Stage 8 (Sequence Assessment) is documented
   - Verify sequence directory structure is shown

2. Run all tests:
   ```
   pytest .claude/skills/lesson-designer/tests/test_sequence*.py -v
   ```
   Expected: All tests pass (test_sequence_manager, test_sequence_context, test_sequence_assessment, test_sequence_e2e)

3. Manual verification (optional):
   - Create a test sequence using the documented workflow
   - Verify context builds correctly for lesson 2+
   - Verify vocabulary tracking works
  </how-to-verify>
  <resume-signal>Type "approved" if tests pass and documentation looks correct, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. SKILL.md is version 3.0.0
2. Stage 0.5 and Stage 8 are documented
3. Sequence directory structure is documented
4. All sequence tests pass: `pytest .claude/skills/lesson-designer/tests/test_sequence*.py -v`
5. Integration test proves end-to-end workflow
</verification>

<success_criteria>
- SKILL.md documents complete sequence workflow (Stages 0.5 and 8)
- End-to-end test passes exercising full 3-lesson sequence
- All phase requirements (SEQN-01 through SEQN-04) are met
- Teacher can plan multi-lesson sequences with context awareness
</success_criteria>

<output>
After completion, create `.planning/phases/05-multi-lesson-sequences/05-04-SUMMARY.md`
</output>
