---
phase: 05-multi-lesson-sequences
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/lesson-designer/scripts/parse_competency.py
  - .claude/skills/lesson-designer/scripts/sequence_manager.py
autonomous: true

must_haves:
  truths:
    - "Teacher can create a multi-lesson sequence with competencies and lesson count"
    - "Each lesson has its own subdirectory within the sequence"
    - "Sequence metadata tracks competencies, lesson ranges, and vocabulary progression"
  artifacts:
    - path: ".claude/skills/lesson-designer/scripts/sequence_manager.py"
      provides: "Sequence session management"
      exports: ["create_sequence_session", "get_sequence_metadata", "get_lesson_directory", "save_sequence_metadata"]
    - path: ".claude/skills/lesson-designer/scripts/parse_competency.py"
      provides: "Extended session utilities"
      contains: "get_sessions_dir"
  key_links:
    - from: "sequence_manager.py"
      to: "parse_competency.py"
      via: "imports get_sessions_dir, get_project_root"
      pattern: "from parse_competency import"
---

<objective>
Create sequence session management infrastructure for multi-lesson planning.

Purpose: Enable teachers to plan 2-4 week units where lessons build on each other. This establishes the data structures and file organization for sequences before adding context awareness.

Output: New sequence_manager.py with functions to create/manage multi-lesson sequences, extending the existing session management pattern.
</objective>

<execution_context>
@C:\Users\david\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\david\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-multi-lesson-sequences/05-RESEARCH.md

# Existing session management to extend
@.claude/skills/lesson-designer/scripts/parse_competency.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sequence_manager.py with session management</name>
  <files>.claude/skills/lesson-designer/scripts/sequence_manager.py</files>
  <action>
Create new file sequence_manager.py that provides multi-lesson sequence management.

Implement these functions following the pattern in parse_competency.py:

1. `create_sequence_session(competencies: list[str], grade_level: str, total_lessons: int, lesson_duration: int) -> str`
   - Generate sequence_id using existing generate_session_id()
   - Create directory structure: .lesson-designer/sessions/{sequence_id}/
   - Create subdirectories: lesson_01/, lesson_02/, ... lesson_N/
   - Write sequence_metadata.json with schema:
     ```json
     {
       "sequence_id": "uuid-string",
       "grade_level": "8th grade",
       "total_lessons": 4,
       "lesson_duration": 55,
       "competencies": [
         {
           "id": "comp-01",
           "statement": "competency text",
           "lesson_range": null,
           "prerequisites": []
         }
       ],
       "vocabulary_progression": {},
       "lessons_complete": 0,
       "created_at": "ISO timestamp"
     }
     ```
   - Return sequence_id

2. `get_sequence_metadata(sequence_id: str) -> dict`
   - Load and return sequence_metadata.json
   - Raise FileNotFoundError if not exists

3. `save_sequence_metadata(sequence_id: str, metadata: dict) -> Path`
   - Write metadata to sequence_metadata.json
   - Return path to saved file

4. `get_lesson_directory(sequence_id: str, lesson_num: int) -> Path`
   - Return path to lesson_N/ subdirectory
   - Validate lesson_num is within total_lessons range

5. `assign_competency_to_lessons(sequence_id: str, competency_id: str, start_lesson: int, end_lesson: int) -> None`
   - Update competency's lesson_range in metadata
   - Validate lesson numbers are within bounds

6. `mark_lesson_complete(sequence_id: str, lesson_num: int) -> None`
   - Increment lessons_complete counter
   - Validate lesson_num hasn't already been marked

Import from parse_competency: get_sessions_dir, generate_session_id, get_project_root

Include docstrings and type hints matching existing code style.
Add if __name__ == '__main__' test block like parse_competency.py.
  </action>
  <verify>
Run: `python .claude/skills/lesson-designer/scripts/sequence_manager.py`
Expected: "All tests passed!" output with sequence created, metadata saved/loaded, lesson directories accessible
  </verify>
  <done>
sequence_manager.py exists with all 6 functions, self-test passes, creates proper directory structure
  </done>
</task>

<task type="auto">
  <name>Task 2: Create test for sequence session management</name>
  <files>.claude/skills/lesson-designer/tests/test_sequence_manager.py</files>
  <action>
Create test file that exercises sequence_manager.py functions.

Test cases:
1. `test_create_sequence_session` - Creates sequence with 4 lessons, verifies:
   - sequence_id is UUID format
   - sequence_metadata.json exists
   - lesson_01/ through lesson_04/ directories exist
   - metadata contains correct competencies, total_lessons

2. `test_assign_competency_to_lessons` - Assigns competency to lessons 1-2, verifies:
   - lesson_range updated in metadata
   - Invalid lesson numbers raise ValueError

3. `test_get_lesson_directory` - Gets lesson paths, verifies:
   - Returns correct Path for valid lesson numbers
   - Raises ValueError for lesson 0 or lesson > total_lessons

4. `test_mark_lesson_complete` - Marks lessons complete, verifies:
   - lessons_complete increments
   - Double-marking same lesson raises ValueError

Use pytest fixtures for session setup/teardown (clean up test sessions).
Import shutil for directory cleanup.
  </action>
  <verify>
Run: `pytest .claude/skills/lesson-designer/tests/test_sequence_manager.py -v`
Expected: All 4 tests pass
  </verify>
  <done>
test_sequence_manager.py exists, all tests pass, validates sequence session management works correctly
  </done>
</task>

</tasks>

<verification>
1. `python .claude/skills/lesson-designer/scripts/sequence_manager.py` outputs "All tests passed!"
2. `pytest .claude/skills/lesson-designer/tests/test_sequence_manager.py -v` - all tests pass
3. Directory structure created: .lesson-designer/sessions/{id}/lesson_01/, lesson_02/, etc.
4. sequence_metadata.json schema matches specification
</verification>

<success_criteria>
- Teacher can create a multi-lesson sequence with `create_sequence_session()`
- Sequence metadata tracks competencies and their lesson assignments
- Each lesson has its own subdirectory ready for lesson files
- Vocabulary progression field exists (empty dict initially, populated by later plans)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-multi-lesson-sequences/05-01-SUMMARY.md`
</output>
